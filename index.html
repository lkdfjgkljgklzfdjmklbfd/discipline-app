<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<title>DISCIPLINE</title>

<style>
:root{
  --red:#ff1a1a;
  --red2:#b30000;
  --panel: rgba(10,10,10,0.92);
  --panel2: rgba(18,18,18,0.92);
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.65);
}
*{ box-sizing:border-box; }
html, body{ height:100%; }
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#000;
  color:var(--text);
  overflow:hidden;
}
canvas{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  z-index:-2;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.25), rgba(0,0,0,0.82));
  z-index:-1;
}

/* top-right streak */
#streakBox{
  position:fixed;
  top: calc(env(safe-area-inset-top) + 12px);
  right: 12px;
  font-size:13px;
  color:rgba(255,255,255,0.85);
  z-index:99999;
  pointer-events:none;
}
/* bottom-right credit */
#credit{
  position:fixed;
  bottom: calc(env(safe-area-inset-bottom) + 12px);
  right:12px;
  font-size:12px;
  color:rgba(255,255,255,0.55);
  letter-spacing:1px;
  z-index:9999;
  pointer-events:none;
}

#container{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.card{
  width:min(860px, 100%);
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border:1px solid rgba(255,26,26,0.14);
  border-radius:24px;
  box-shadow:
    0 25px 60px rgba(0,0,0,0.75),
    0 0 0 1px rgba(255,26,26,0.18),
    inset 0 1px 0 rgba(255,255,255,0.04),
    inset 0 -30px 80px rgba(0,0,0,0.35);
  padding:28px;
  transform: translateZ(0);
}
#intro{ text-align:center; }
#intro h1{
  font-size: clamp(42px, 7vw, 66px);
  font-weight: 800;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  margin: 0;
  line-height: 1;
  color: var(--red);
  text-shadow:
    0 0 8px rgba(255,0,0,0.35),
    0 0 20px rgba(255,0,0,0.18);
}
#intro h2{
  margin-top: 12px;
  font-size: 12px;
  letter-spacing: 0.35em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.65);
  font-weight: 650;
}
.terminal-line{
  width: min(360px, 85%);
  height: 2px;
  margin: 16px auto 10px;
  background: linear-gradient(90deg, transparent, rgba(255,0,0,0.95), transparent);
  box-shadow: 0 0 14px rgba(255,0,0,0.4);
}

#mode{
  font-size:22px;
  margin:6px 0 12px;
  letter-spacing:0.5px;
}

button{
  appearance:none;
  border:none;
  cursor:pointer;
  background: linear-gradient(180deg, var(--red2), #7a0000);
  color:white;
  font-weight:800;
  letter-spacing:1px;
  border-radius:16px;
  height:54px;
  padding:0 18px;
  min-width: 220px;
  box-shadow: 0 10px 26px rgba(255,0,0,0.18);
  transition: transform .08s ease, filter .15s ease;
}
button:hover{ filter:brightness(1.08); }
button:active{ transform: scale(0.98); }
.card button{ margin:10px 8px 0; }

.choice{
  background: rgba(28,28,28,0.92);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 20px;
  padding: 18px 16px;
  margin: 12px 0;
  cursor: pointer;
  font-size: 19px;
  line-height: 1.35;
  text-align: left;
  box-shadow: 0 10px 30px rgba(0,0,0,0.45);
  font-weight: 500;
  letter-spacing: 0.2px;
  color: rgba(255,255,255,0.88);
}
.choice.selected{
  border-color: rgba(255,26,26,0.90);
  box-shadow: 0 0 0 2px rgba(255,26,26,0.28), 0 12px 34px rgba(0,0,0,0.5);
  font-weight: 600;
}

.word-container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin:16px 0;
  min-height:64px;
  padding:10px;
  border-radius:16px;
  background: rgba(28,28,28,0.75);
  border:1px solid rgba(255,255,255,0.10);
}
.word{
  background: rgba(255,26,26,0.18);
  border:1px solid rgba(255,26,26,0.28);
  padding:10px 14px;
  border-radius:16px;
  font-size:17px;
  font-weight:500;
  user-select:none;
  cursor:pointer;
}

#hud{
  margin-bottom:14px;
  padding-right: 120px;
}
#hud *{ font-size:14px !important; }

#result{
  margin-top:14px;
  font-size:18px;
  font-weight:900;
  letter-spacing:0.5px;
}
.hint{
  margin-top:12px;
  color:var(--muted);
  font-size:13px;
}

#toast{
  position: fixed;
  left: 50%;
  top: calc(env(safe-area-inset-top) + 20px);
  transform: translateX(-50%);
  z-index: 999999;
  pointer-events: none;
  opacity: 0;
}
.toast-inner{
  display:flex;
  align-items:center;
  gap:10px;
  background: rgba(20,20,20,0.92);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 999px;
  padding: 10px 14px;
  box-shadow: 0 16px 50px rgba(0,0,0,0.55);
  font-weight: 900;
  letter-spacing: 0.6px;
}
.toast-inner.good{
  border-color: rgba(255,26,26,0.45);
  box-shadow: 0 0 0 2px rgba(255,26,26,0.14), 0 16px 50px rgba(0,0,0,0.55);
}
.toast-inner.bad{
  border-color: rgba(255,255,255,0.12);
  opacity: 0.95;
}
.toast-show{ animation: toastInOut 1.0s ease forwards; }
@keyframes toastInOut{
  0%{ opacity:0; transform: translateX(-50%) translateY(-8px) scale(0.96); }
  15%{ opacity:1; transform: translateX(-50%) translateY(0px) scale(1); }
  80%{ opacity:1; transform: translateX(-50%) translateY(0px) scale(1); }
  100%{ opacity:0; transform: translateX(-50%) translateY(-10px) scale(0.98); }
}

#rankUpOverlay{
  position: fixed;
  inset: 0;
  z-index: 999998;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,0.78);
  backdrop-filter: blur(8px);
}
.rankup-card{
  width: min(520px, 100%);
  border-radius: 24px;
  padding: 22px;
  background: linear-gradient(180deg, rgba(16,16,16,0.96), rgba(8,8,8,0.96));
  border: 1px solid rgba(255,26,26,0.20);
  box-shadow: 0 22px 80px rgba(255,0,0,0.14);
  text-align: center;
}
.rankup-badge{
  width: 92px;
  height: 92px;
  border-radius: 22px;
  margin: 0 auto 14px;
  background: radial-gradient(circle at 30% 30%, rgba(255,26,26,0.45), rgba(255,26,26,0.10));
  border: 1px solid rgba(255,26,26,0.25);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 40px;
  box-shadow: 0 0 0 6px rgba(255,26,26,0.06);
}
.rankup-title{
  font-weight: 900;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.95);
  margin: 0 0 6px;
}
.rankup-name{
  font-size: 26px;
  font-weight: 900;
  color: var(--red);
  letter-spacing: 1px;
  margin: 0 0 12px;
  text-shadow: 0 0 12px rgba(255,0,0,0.25);
}
.rankup-sub{
  color: rgba(255,255,255,0.70);
  margin: 0 0 14px;
}
.rankup-btn{
  width: 100%;
  min-width: unset;
  height: 56px;
  border-radius: 18px;
}

.shake{ animation: shake 0.35s ease; }
@keyframes shake{
  0%{ transform: translateX(0); }
  20%{ transform: translateX(-10px); }
  40%{ transform: translateX(10px); }
  60%{ transform: translateX(-7px); }
  80%{ transform: translateX(7px); }
  100%{ transform: translateX(0); }
}

@media (max-width: 520px){
  #container{
    padding: 0 !important;
    height: 100dvh;
    align-items: stretch;
  }
  .card{
    width: 100%;
    min-height: 100dvh;
    border-radius: 0 !important;
    padding:
      calc(env(safe-area-inset-top) + 16px)
      16px
      calc(env(safe-area-inset-bottom) + 18px)
      16px !important;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
  }
  #content{
    flex:1;
    overflow:auto;
    padding-bottom: 86px;
    -webkit-overflow-scrolling: touch;
  }
  .btn.play{
    width: 64%;
    max-width: 320px;
    min-width: unset;
    height: 52px;
    font-size: 15px;
    border-radius: 18px;
    align-self:center;
    margin-left:auto;
    margin-right:auto;
  }
  .btn.check{
    position: sticky;
    bottom: calc(env(safe-area-inset-bottom) + 10px);
    width: 100%;
    min-width: unset;
    height: 58px;
    font-size: 16px;
    border-radius: 18px;
    margin: 14px 0 0;
  }
}

/* ===== Rank modal (popup) ===== */
#rankModal {
  position: fixed;
  inset: 0;
  z-index: 999997;
  display: none;               /* hidden by default */
  align-items: center;
  justify-content: center;
  padding: 16px;
  background: rgba(0,0,0,0.72);
  backdrop-filter: blur(8px);
}

#rankModal.show {
  display: flex;
}

.rank-modal-card {
  width: min(560px, 100%);
  border-radius: 22px;
  padding: 18px 18px 16px;
  background: linear-gradient(180deg, rgba(16,16,16,0.96), rgba(8,8,8,0.96));
  border: 1px solid rgba(255,26,26,0.22);
  box-shadow: 0 28px 90px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,26,26,0.12);
  position: relative;
}

.rank-modal-title {
  margin: 0;
  font-weight: 900;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.92);
  font-size: 16px;
}

.rank-modal-sub {
  margin: 6px 0 14px;
  color: rgba(255,255,255,0.65);
  font-size: 13px;
  line-height: 1.35;
}

.rank-close {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 44px;
  height: 44px;
  border-radius: 14px;
  min-width: unset;
  padding: 0;
  font-weight: 900;
  letter-spacing: 0;
}

.rank-table {
  width: 100%;
  border-collapse: collapse;
  overflow: hidden;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.12);
}

.rank-table th,
.rank-table td {
  padding: 12px 12px;
  font-size: 14px;
  color: rgba(255,255,255,0.88);
}

.rank-table th {
  text-align: left;
  color: rgba(255,255,255,0.70);
  font-weight: 800;
  background: rgba(28,28,28,0.85);
  border-bottom: 1px solid rgba(255,255,255,0.10);
}

.rank-table tr {
  background: rgba(20,20,20,0.70);
}

.rank-table tr + tr td {
  border-top: 1px solid rgba(255,255,255,0.08);
}

.rank-badge {
  display: inline-block;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,26,26,0.22);
  background: rgba(255,26,26,0.10);
  font-weight: 900;
  letter-spacing: 0.6px;
}

.rank-range {
  color: rgba(255,255,255,0.70);
  font-weight: 700;
}

.rank-hintline {
  margin-top: 12px;
  font-size: 12px;
  color: rgba(255,255,255,0.62);
}

/* Clickable rank in HUD */
#rankBtn {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.16);
  color: rgba(255,255,255,0.88);
  height: 34px;
  min-width: unset;
  padding: 0 10px;
  border-radius: 12px;
  font-weight: 900;
  letter-spacing: 0.6px;
  box-shadow: none;
}

#rankBtn:hover { filter: brightness(1.1); }

</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="streakBox"></div>
<div id="credit">made by Frihet</div>

<div id="toast">
  <div id="toastInner" class="toast-inner">
    <span>ðŸ’°</span>
    <span class="delta" id="toastText">+2</span>
  </div>
</div>

<div id="rankUpOverlay">
  <div class="rankup-card">
    <div class="rankup-badge">ðŸ’°</div>
    <h3 class="rankup-title">RANK UP</h3>
    <div class="rankup-name" id="rankUpName">Millionaire</div>
    <p class="rankup-sub" id="rankUpSub">Upgrade secured. Keep going.</p>
    <button class="rankup-btn" onclick="closeRankUp()">CONTINUE â†’</button>
  </div>
</div>

  
<!-- Rank ladder modal -->
<div id="rankModal" onclick="onRankBackdrop(event)">
  <div class="rank-modal-card">
    <button class="rank-close" onclick="toggleRankModal(false)">âœ•</button>

    <h3 class="rank-modal-title">RANK LADDER</h3>
    <p class="rank-modal-sub">
      Your money unit is <b>FSD ðŸ’°</b>. More FSD = higher rank.
    </p>

    <table class="rank-table">
      <thead>
        <tr>
          <th>Rank</th>
          <th>FSD Range</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="rank-badge">Loser</span></td>
          <td class="rank-range">0â€“49 FSD</td>
        </tr>
        <tr>
          <td><span class="rank-badge">NPC</span></td>
          <td class="rank-range">50â€“149 FSD</td>
        </tr>
        <tr>
          <td><span class="rank-badge">Human</span></td>
          <td class="rank-range">150â€“299 FSD</td>
        </tr>
        <tr>
          <td><span class="rank-badge">Rich</span></td>
          <td class="rank-range">300â€“599 FSD</td>
        </tr>
        <tr>
          <td><span class="rank-badge">Millionaire</span></td>
          <td class="rank-range">600â€“999 FSD</td>
        </tr>
        <tr>
          <td><span class="rank-badge">Billionaire</span></td>
          <td class="rank-range">1000â€“999999 FSD</td>
        </tr>
      </tbody>
    </table>

    <div class="rank-hintline">
      Tip: Tap <b>Rank</b> again or press âœ• to close.
    </div>
  </div>
</div>


<div id="container">
  <div class="card" id="intro">
    <h1>DISCIPLINE</h1>
    <h2>YOU VS YOU</h2>
    <div class="terminal-line"></div>
    <button class="btn" onclick="startGame()">START SESSION â†’</button>
    <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px; letter-spacing: 1px;">
      made by Frihet
    </p>
  </div>
</div>

<script>
/* ===== Canvas setup ===== */
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");
function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ===== Trading chart background (scrolling candles) ===== */
let candles = [];
function rand(min, max){ return Math.random() * (max - min) + min; }

const SPEED = 0.55;
const GAP_MIN = 6, GAP_MAX = 14;
const BODY_W_MIN = 6, BODY_W_MAX = 12;

const UP_BODY_A = 0.22, UP_WICK_A = 0.16;
const DOWN_BODY_A = 0.28, DOWN_WICK_A = 0.18;

function makeCandle(spawnRight=false){
  const w = rand(BODY_W_MIN, BODY_W_MAX);
  const gap = rand(GAP_MIN, GAP_MAX);
  const bodyH = rand(14, 80);
  const wickTop = rand(6, 34);
  const wickBot = rand(6, 30);
  const bandTop = canvas.height * 0.18;
  const bandBot = canvas.height * 0.88;
  const y = rand(bandTop, bandBot - bodyH);
  const isUp = Math.random() < 0.42;

  const upRGB = { r: 40, g: 220, b: 120 };
  const dnRGB = { r: 255, g: 40, b: 40 };

  return {
    x: spawnRight ? canvas.width + rand(0, 200) : rand(0, canvas.width),
    y, w, gap, bodyH, wickTop, wickBot, isUp,
    r: isUp ? upRGB.r : dnRGB.r,
    g: isUp ? upRGB.g : dnRGB.g,
    b: isUp ? upRGB.b : dnRGB.b
  };
}

function initChartCandles(){
  candles = [];
  let x = -50;
  while(x < canvas.width + 250){
    const c = makeCandle(false);
    c.x = x;
    candles.push(c);
    x += c.w + c.gap;
  }
}
initChartCandles();

function drawChartCandle(c){
  const centerX = c.x + c.w/2;
  const wickX = centerX;
  const bodyA = c.isUp ? UP_BODY_A : DOWN_BODY_A;
  const wickA = c.isUp ? UP_WICK_A : DOWN_WICK_A;

  ctx.lineWidth = 1.2;
  ctx.strokeStyle = `rgba(${c.r},${c.g},${c.b},${wickA})`;
  ctx.beginPath();
  ctx.moveTo(wickX, c.y - c.wickTop);
  ctx.lineTo(wickX, c.y + c.bodyH + c.wickBot);
  ctx.stroke();

  ctx.fillStyle = `rgba(${c.r},${c.g},${c.b},${bodyA})`;
  ctx.fillRect(c.x, c.y, c.w, c.bodyH);

  ctx.fillStyle = `rgba(255,255,255,0.035)`;
  ctx.fillRect(c.x + 1, c.y + 2, 1, Math.max(8, c.bodyH - 4));
}

function animateChart(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  candles.forEach(drawChartCandle);
  candles.forEach(c => { c.x -= SPEED; });

  while(candles.length && candles[0].x + candles[0].w < -60) candles.shift();

  let last = candles[candles.length - 1];
  while(last && last.x < canvas.width + 200){
    const nc = makeCandle(true);
    nc.x = last.x + last.w + last.gap;
    candles.push(nc);
    last = nc;
  }

  requestAnimationFrame(animateChart);
}
animateChart();

window.addEventListener("resize", () => { resizeCanvas(); initChartCandles(); });

/* ===== Daily Streak ===== */
function updateStreak() {
  let today = new Date().toDateString();
  let last = localStorage.getItem("lastDate");
  let streak = parseInt(localStorage.getItem("streak") || "0");

  if (last !== today) {
    let yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    if (last === yesterday.toDateString()) streak++;
    else streak = 1;
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastDate", today);
  }
  document.getElementById("streakBox").innerText = "ðŸ”¥ Streak: " + (localStorage.getItem("streak") || 1);
}
updateStreak();

/* ===== Sentences ===== */
const items = [
  { en:"I feel you, bro. Iâ€™ve also been through a lot.", de:"Ich fÃ¼hl dich, Bro. Ich hab auch schon viel durchgemacht.", es:"Te entiendo, bro. Yo tambiÃ©n he pasado por mucho." },
  { en:"You donâ€™t need motivation. you just need discipline, bro.", de:"Du brauchst keine Motivation. Du brauchst Disziplin, Bro.", es:"No necesitas motivaciÃ³n. Necesitas disciplina, bro." },
  { en:"You just need to control yourself. itâ€™s you vs you, bro.", de:"Du musst dich einfach kontrollieren. Es geht nur um dich gegen dich, Bro.", es:"Solo tienes que controlarte. Es tÃº contra tÃº, bro." },
  { en:"I want you to succeed, bro. I believe in you.", de:"Ich will, dass du Erfolg hast, Bro. Ich glaub an dich.", es:"Quiero que tengas Ã©xito, bro. Creo en ti." },
  { en:"But you know, someone has to do 9 to 5 stuff. Not everyone can be a millionaire.", de:"Aber weiÃŸt du, irgendwer muss halt den 9-to-5-Job machen. Nicht jeder wird MillionÃ¤r.", es:"Pero ya sabes, alguien tiene que trabajar de 9 a 5. No todos van a ser millonarios." },
  { en:"I know itâ€™s hard but dude nothing is easy in this world. You gotta work hard.", de:"Ich weiÃŸ, es ist hart, aber nichts auf dieser Welt ist leicht. Du musst hart arbeiten.", es:"SÃ© que es difÃ­cil, pero nada en este mundo es fÃ¡cil. Tienes que trabajar duro." },
  { en:"Go ghost, bro. You canâ€™t grow when people are around you.", de:"Zieh dich zurÃ¼ck, Bro. Du kannst nicht wachsen, wenn stÃ¤ndig Leute um dich herum sind.", es:"Desaparece un rato, bro. No puedes crecer si la gente siempre estÃ¡ alrededor." },
  { en:"Lock in. You wanna be rich or not?", de:"Fokussier dich. Willst du reich werden oder nicht?", es:"ConcÃ©ntrate. Â¿Quieres ser rico o no?" },
  { en:"I donâ€™t wanna be an NPC, bro. Thatâ€™s why Iâ€™m working this hard.", de:"Ich will kein NPC sein, Bro. Deshalb arbeite ich so hart.", es:"No quiero ser un NPC, bro. Por eso estoy trabajando asÃ­ de duro." },
  { en:"You think I enjoy going to the gym every day? Hell nah, bro. I genuinely donâ€™t.", de:"Denkst du, ich geh gern jeden Tag ins Gym? Hell nah, Bro. Ehrlich nicht.", es:"Â¿Crees que disfruto ir al gym todos los dÃ­as? Hell nah, bro. De verdad que no." },
  { en:"You live only one life, bro. Nothing can stop you. do what you want.", de:"Du hast nur ein Leben, Bro. Nichts kann dich aufhalten. Mach, was du willst.", es:"Solo tienes una vida, bro. Nada puede detenerte. Haz lo que quieras." },
  { en:"If you want big money, make a big move. You canâ€™t get rich with a 9 to 5 job, you know that.", de:"Wenn du groÃŸes Geld willst, musst du groÃŸe Moves machen. Mit einem 9-to-5-Job wirst du nicht reich, das weiÃŸt du.", es:"Si quieres mucho dinero, haz un gran movimiento. No te vas a hacer rico con un trabajo de 9 a 5, tÃº lo sabes." },
  { en:"If you wanna be different, you gotta be emotionless, bro. Learn to control your emotions", de:"Wenn du anders sein willst, musst du emotionslos sein, Bro. Lern, deine Emotionen zu kontrollieren.", es:"Si quieres ser diferente, tienes que ser frÃ­o, bro. Aprende a controlar tus emociones." },
  { en:"Bro, everyoneâ€™s lost. Itâ€™s not just you. Weâ€™re all lost. Thatâ€™s the beauty of life", de:"Bro, jeder ist verloren. Nicht nur du. Wir sind alle verloren. Das ist das SchÃ¶ne am Leben.", es:"Bro, todos estamos perdidos. No eres solo tÃº. Todos estamos perdidos. Esa es la belleza de la vida." },
  { en:"Go hit the gym, bro. It's your body. Take care of it.", de:"Geh ins Gym, Bro. Das ist dein KÃ¶rper. KÃ¼mmere dich darum.", es:"Ve al gym, bro. Es tu cuerpo. CuÃ­dalo."}
];

/* ===== LEVELS ===== */
const LEVELS = [
  { id:"L1", name:"Passive",     idx:[0,1,3,10,13,14] },
  { id:"L2", name:"Grinder",     idx:[2,5,6,7] },
  { id:"L3", name:"Millionaire", idx:[4,8,9,11,12] }
];

let activeItems = [];
let activeLevel = "L1";

/* ===== Language UI ===== */
let nativeLang = localStorage.getItem("nativeLang") || "en";
const UI = {
  en: { chooseNative:"Choose your native language", chooseLevel:"Choose your level",
        levelNote:"Be honest", chooseMode:"Choose mode",
        play:"PLAY", check:"CHECK",
        listenDecide:"Listen & Decide", buildFocus:"Build With Focus",
        sessionComplete:"Session Complete", score:"Score", restart:"Restart",
        strong:"LOCKED.", reset:"-1. Refocus.", fsd:"FSD", rank:"Rank", progress:"Progress" },
  de: { chooseNative:"WÃ¤hle deine Muttersprache", chooseLevel:"WÃ¤hle dein Level",
        levelNote:"HÃ¶heres Level = hÃ¤rtere SÃ¤tze + stÃ¤rkeres Mindset.", chooseMode:"Modus wÃ¤hlen",
        play:"PLAY", check:"PRÃœFEN",
        listenDecide:"HÃ¶ren & Entscheiden", buildFocus:"Satz bauen",
        sessionComplete:"Session beendet", score:"Punktzahl", restart:"Neustart",
        strong:"LOCKED.", reset:"-1. Fokus.", fsd:"FSD", rank:"Rang", progress:"Fortschritt" },
  es: { chooseNative:"Elige tu idioma nativo", chooseLevel:"Elige tu nivel",
        levelNote:"Nivel mÃ¡s alto = frases mÃ¡s fuertes + inglÃ©s mÃ¡s difÃ­cil.", chooseMode:"Elige modo",
        play:"PLAY", check:"COMPROBAR",
        listenDecide:"Escucha y decide", buildFocus:"Construye la frase",
        sessionComplete:"SesiÃ³n terminada", score:"PuntuaciÃ³n", restart:"Reiniciar",
        strong:"LOCKED.", reset:"-1. EnfÃ³cate.", fsd:"FSD", rank:"Rango", progress:"Progreso" }
};
function t(key){ return (UI[nativeLang] && UI[nativeLang][key]) || UI.en[key] || key; }
function displayText(i){ const obj = activeItems[i]; return obj[nativeLang] || obj.en; }

/* ===== Game State ===== */
let used = [];
let currentIndex = 0;
let score = 0;
let round = 0;
let selectedChoice = null;
let audio = null;
let gameMode = "mix";

/* ===== FSD persistent ===== */
const FSD_KEY = "fsd_forever";
function getFSD(){ return parseInt(localStorage.getItem(FSD_KEY) || "0"); }
function setFSD(v){ if(v < 0) v = 0; localStorage.setItem(FSD_KEY, String(v)); }
function addFSD(delta){
  const old = getFSD();
  setFSD(old + delta);
  return { old, now: getFSD() };
}

/* ===== Ranks ===== */
const RANKS = [
  { name:"Loser",       min:0,    max:49 },
  { name:"NPC",         min:50,   max:149 },
  { name:"Human",       min:150,  max:299 },
  { name:"Rich",        min:300,  max:599 },
  { name:"Millionaire", min:600,  max:999 },
  { name:"Billionaire", min:1000, max:999999 }
];
function rankFor(v){
  for(const r of RANKS){ if(v >= r.min && v <= r.max) return r; }
  return RANKS[0];
}
function nextRankInfo(v){
  const r = rankFor(v);
  const idx = RANKS.indexOf(r);
  if(idx === RANKS.length - 1) return { pct:100, label:"MAX" };
  const next = RANKS[idx+1];
  const needTotal = next.min - r.min;
  const have = v - r.min;
  const pct = Math.max(0, Math.min(100, Math.round((have/needTotal)*100)));
  return { pct, label:`${v}/${next.min}` };
}

/* ===== Screens flow ===== */
function startGame(){
  document.getElementById("container").innerHTML = `
    <div class="card">
      <h2 style="margin-top:0;">${t("chooseNative")}</h2>
      <div style="margin-top:18px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center;">
        <button onclick="chooseLang('en')">ðŸ‡¬ðŸ‡§ English</button>
        <button onclick="chooseLang('de')">ðŸ‡©ðŸ‡ª Deutsch</button>
        <button onclick="chooseLang('es')">ðŸ‡ªðŸ‡¸ EspaÃ±ol</button>
      </div>
      <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px;">made by Frihet</p>
    </div>
  `;
}

function chooseLang(lang){
  nativeLang = lang;
  localStorage.setItem("nativeLang", lang);

  document.getElementById("container").innerHTML = `
    <div class="card">
      <h2 style="margin-top:0;">${t("chooseLevel")}</h2>
      <p style="color:#aaa; margin-top:8px;">${t("levelNote")}</p>
      <div id="levelBtns" style="display:flex; flex-direction:column; gap:12px; margin-top:16px;"></div>
      <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px;">made by Frihet</p>
    </div>
  `;
  const wrap = document.getElementById("levelBtns");
  LEVELS.forEach(lv=>{
    const b = document.createElement("button");
    b.textContent = lv.name;
    b.onclick = () => startLevel(lv.id);
    wrap.appendChild(b);
  });
}

/* IMPORTANT: startLevel shows ONLY mode screen */
function startLevel(levelId){
  activeLevel = levelId;
  const lv = LEVELS.find(x => x.id === levelId);
  activeItems = lv.idx.map(i => items[i]);

  used = [];
  score = 0;
  round = 0;
  selectedChoice = null;
  stopAudio();

  document.getElementById("container").innerHTML = `
    <div class="card">
      <h2 style="margin-top:0;">${t("chooseMode")}</h2>
      <div style="margin-top:18px; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <button onclick="startRealGame('listen')">${t("listenDecide")}</button>
        <button onclick="startRealGame('build')">${t("buildFocus")}</button>
        <button onclick="startRealGame('mix')">Mix</button>
      </div>
      <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px;">made by Frihet</p>
    </div>
  `;
}

/* startRealGame builds HUD + game UI and starts */
function startRealGame(mode){
  gameMode = mode;

  document.getElementById("container").innerHTML = `
    <div class="card" id="gameCard">
      <div id="hud" style="text-align:left; margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">
          <div style="font-size:13px; color:#aaa;">
            ${t("progress")}: <span id="progressText">0/${activeItems.length}</span>
          </div>
          <div style="font-size:13px; color:#aaa; text-align:right;">
            ðŸ’° ${t("fsd")}: <span id="fsdText">0</span><br>
           ${t("rank")}: <button id="rankBtn" onclick="toggleRankModal(true)"><span id="rankText">Loser</span> â“˜</button>
          </div>
        </div>

        <div style="margin-top:10px; background:#1a1a1a; border-radius:999px; height:10px; overflow:hidden;">
          <div id="progressBar" style="height:10px; width:0%; background:#ff1a1a;"></div>
        </div>

        <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
          <div style="font-size:13px; color:#aaa;">
            Next: <span id="nextRankText">0/50</span>
          </div>
        </div>

        <div style="margin-top:8px; background:#1a1a1a; border-radius:999px; height:10px; overflow:hidden;">
          <div id="rankBar" style="height:10px; width:0%; background:#ff1a1a;"></div>
        </div>
      </div>

      <h2 id="mode"></h2>
      <button class="btn play" onclick="playAudio()">${t("play")}</button>
      <div id="content"></div>
      <div id="result"></div>
    </div>
  `;

  updateHUD();
  nextRound();
}

/* ===== HUD ===== */
function updateHUD(){
  const done = used.length;
  const progressText = document.getElementById("progressText");
  const progressBar = document.getElementById("progressBar");
  if(progressText) progressText.innerText = done + "/" + activeItems.length;
  if(progressBar){
    const pct = Math.round((done / activeItems.length) * 100);
    progressBar.style.width = pct + "%";
  }

  const fsd = getFSD();
  const r = rankFor(fsd);
  const nxt = nextRankInfo(fsd);

  const fsdText = document.getElementById("fsdText");
  const rankText = document.getElementById("rankText");
  const nextRankText = document.getElementById("nextRankText");
  const rankBar = document.getElementById("rankBar");

  if(fsdText) fsdText.innerText = fsd;
  if(rankText) rankText.innerText = r.name;
  if(nextRankText) nextRankText.innerText = nxt.label;
  if(rankBar) rankBar.style.width = (nxt.pct || 0) + "%";
}

/* ===== Helpers ===== */
function normalize(s){
  return s.toLowerCase().replace(/[.,!?]/g,"").replace(/\s+/g,"").trim();
}

/* ===== Game loop ===== */
function nextRound(){
  if(round >= activeItems.length){
    const fsd = getFSD();
    const r = rankFor(fsd);
    document.getElementById("content").innerHTML =
      `<h2>${t("sessionComplete")}</h2>
       <p>${t("score")}: ${score} / ${activeItems.length}</p>
       <p>ðŸ’° ${t("fsd")}: ${fsd} (${t("rank")}: ${r.name})</p>
       <button onclick="location.reload()">${t("restart")}</button>`;
    return;
  }

  round++;
  selectedChoice = null;
  document.getElementById("result").innerText = "";
  document.getElementById("content").innerHTML = "";

  do{
    currentIndex = Math.floor(Math.random()*activeItems.length);
  } while(used.includes(currentIndex));

  used.push(currentIndex);
  updateHUD();

  if(gameMode === "listen") buildListen();
  else if(gameMode === "build") buildDrag();
  else {
    if(Math.random() > 0.5) buildListen();
    else buildDrag();
  }
}

/* Listen & Decide */
function buildListen(){
  document.getElementById("mode").innerText = t("listenDecide");

  const correctText = displayText(currentIndex);
  let optionIndexes = [currentIndex];

  while(optionIndexes.length < 4){
    const r = Math.floor(Math.random() * activeItems.length);
    if(!optionIndexes.includes(r)) optionIndexes.push(r);
  }
  optionIndexes.sort(()=>0.5 - Math.random());

  optionIndexes.forEach(idx=>{
    let div = document.createElement("div");
    div.className = "choice";
    div.innerText = displayText(idx);
    div.onclick = ()=>{
      document.querySelectorAll(".choice").forEach(c=>c.classList.remove("selected"));
      div.classList.add("selected");
      selectedChoice = displayText(idx);
    };
    document.getElementById("content").appendChild(div);
  });

  let btn = document.createElement("button");
  btn.className = "btn check";
  btn.innerText = t("check");
  btn.onclick = ()=>{
    if(!selectedChoice) return;
    if(normalize(selectedChoice) === normalize(correctText)) success();
    else fail();
  };
  document.getElementById("content").appendChild(btn);

  if(nativeLang !== "en"){
    const hint = document.createElement("div");
    hint.className = "hint";
    hint.innerText = "English: " + activeItems[currentIndex].en;
    document.getElementById("content").appendChild(hint);
  }
}

/* Build With Focus */
function buildDrag(){
  document.getElementById("mode").innerText = t("buildFocus");

  const targetSentence = displayText(currentIndex);
  let words = targetSentence.split(" ");
  let shuffled = [...words].sort(()=>0.5 - Math.random());

  let top = document.createElement("div");
  top.className = "word-container";
  top.id = "top";

  let bottom = document.createElement("div");
  bottom.className = "word-container";
  bottom.id = "bottom";

  shuffled.forEach(w=>{
    let span = document.createElement("div");
    span.className = "word";
    span.innerText = w;
    span.onclick = ()=>{
      if(span.parentElement.id === "bottom") top.appendChild(span);
      else bottom.appendChild(span);
    };
    bottom.appendChild(span);
  });

  let btn = document.createElement("button");
  btn.className = "btn check";
  btn.innerText = t("check");
  btn.onclick = ()=>{
    let built = "";
    document.querySelectorAll("#top .word").forEach(w=>built += w.innerText + " ");
    if(normalize(built) === normalize(targetSentence)) success();
    else fail();
  };

  document.getElementById("content").appendChild(top);
  document.getElementById("content").appendChild(bottom);
  document.getElementById("content").appendChild(btn);

  if(nativeLang !== "en"){
    const hint = document.createElement("div");
    hint.className = "hint";
    hint.innerText = "English: " + activeItems[currentIndex].en;
    document.getElementById("content").appendChild(hint);
  }
}

/* ===== Feedback + FSD ===== */
function showToast(delta){
  const toast = document.getElementById("toast");
  const inner = document.getElementById("toastInner");
  const text = document.getElementById("toastText");
  toast.classList.remove("toast-show");
  inner.classList.remove("good","bad");

  if(delta > 0){
    inner.classList.add("good");
    text.textContent = `+${delta} FSD ðŸ’°`;
  } else {
    inner.classList.add("bad");
    text.textContent = `${delta} FSD ðŸ’°`;
  }
  void toast.offsetWidth;
  toast.classList.add("toast-show");
}
function shakeCard(){
  const card = document.getElementById("gameCard");
  if(!card) return;
  card.classList.remove("shake");
  void card.offsetWidth;
  card.classList.add("shake");
}

let pendingNext = null;
function showRankUp(newRankName){
  const overlay = document.getElementById("rankUpOverlay");
  document.getElementById("rankUpName").textContent = newRankName;
  overlay.style.display = "flex";
}
function closeRankUp(){
  const overlay = document.getElementById("rankUpOverlay");
  overlay.style.display = "none";
  if(typeof pendingNext === "function"){
    const fn = pendingNext;
    pendingNext = null;
    fn();
  }
}

function success(){
  playSound(true);
  score++;
  const beforeRank = rankFor(getFSD()).name;
  const res = addFSD(+2);
  showToast(+2);
  const afterRank = rankFor(res.now).name;
  updateHUD();
  document.getElementById("result").innerText = t("strong");
  stopAudio();

  if(afterRank !== beforeRank){
    pendingNext = () => setTimeout(nextRound, 250);
    showRankUp(afterRank);
    return;
  }
  setTimeout(nextRound, 1200);
}

function fail(){
  playSound(false);
  addFSD(-1);
  showToast(-1);
  shakeCard();
  updateHUD();
  document.getElementById("result").innerText = t("reset");
  stopAudio();
  setTimeout(nextRound, 1500);
}

/* ===== Audio ===== */
function playAudio(){
  stopAudio();
  // You need audio1.mp3 ... audio14.mp3 in same folder as this HTML
  const lv = LEVELS.find(l => l.id === activeLevel);
  const globalIndex = lv.idx[currentIndex] + 1;
  audio = new Audio("audio" + globalIndex + ".mp3");
  audio.play();
}
function stopAudio(){
  if(audio){ audio.pause(); audio.currentTime = 0; }
}

/* Soft sound */
function playSound(success){
  const aCtx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = aCtx.createOscillator();
  const gain = aCtx.createGain();
  osc.connect(gain);
  gain.connect(aCtx.destination);
  osc.frequency.value = success ? 600 : 220;
  gain.gain.value = 0.05;
  osc.start();
  setTimeout(()=>osc.stop(), 100);
}

  /* ===== Rank modal logic ===== */
function toggleRankModal(forceOpen) {
  const modal = document.getElementById("rankModal");
  if (!modal) return;

  const shouldOpen = (typeof forceOpen === "boolean")
    ? forceOpen
    : !modal.classList.contains("show");

  if (shouldOpen) modal.classList.add("show");
  else modal.classList.remove("show");
}

// Close when clicking outside the card (backdrop)
function onRankBackdrop(e) {
  if (e.target && e.target.id === "rankModal") {
    toggleRankModal(false);
  }
}

// ESC key closes (desktop)
window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") toggleRankModal(false);
});
  
</script>
</body>
</html>














