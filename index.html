<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<title>KONTRIJAL</title>

<style>
:root{
  --red:#ff1a1a;
  --red2:#b30000;
  --panel: rgba(10,10,10,0.92);
  --panel2: rgba(18,18,18,0.92);
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.65);
}
*{ box-sizing:border-box; }
html, body{ height:100%; }
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#000;
  color:var(--text);
  overflow:hidden;
}
canvas{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  z-index:-2;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.25), rgba(0,0,0,0.82));
  z-index:-1;
}

/* top-right streak */
#streakBox{
  position:fixed;
  top: calc(env(safe-area-inset-top) + 12px);
  right: 12px;
  font-size:13px;
  color:rgba(255,255,255,0.85);
  z-index:99999;
  pointer-events:none;
}
/* bottom-right credit */
#credit{
  position:fixed;
  bottom: calc(env(safe-area-inset-bottom) + 12px);
  right:12px;
  font-size:12px;
  color:rgba(255,255,255,0.55);
  letter-spacing:1px;
  z-index:9999;
  pointer-events:none;
}

#container{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.card{
  width:min(860px, 100%);
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border:1px solid rgba(255,26,26,0.14);
  border-radius:24px;
  box-shadow:
    0 25px 60px rgba(0,0,0,0.75),
    0 0 0 1px rgba(255,26,26,0.18),
    inset 0 1px 0 rgba(255,255,255,0.04),
    inset 0 -30px 80px rgba(0,0,0,0.35);
  padding:28px;
  transform: translateZ(0);
}
#intro{ text-align:center; }
#intro h1{
  font-size: clamp(42px, 7vw, 66px);
  font-weight: 900;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  margin: 0;
  line-height: 1;
  color: var(--red);
  text-shadow:
    0 0 8px rgba(255,0,0,0.35),
    0 0 20px rgba(255,0,0,0.18);
}
#intro h2{
  margin-top: 12px;
  font-size: 12px;
  letter-spacing: 0.35em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.65);
  font-weight: 750;
}
.terminal-line{
  width: min(360px, 85%);
  height: 2px;
  margin: 16px auto 10px;
  background: linear-gradient(90deg, transparent, rgba(255,0,0,0.95), transparent);
  box-shadow: 0 0 14px rgba(255,0,0,0.4);
}

button{
  appearance:none;
  border:none;
  cursor:pointer;
  background: linear-gradient(180deg, var(--red2), #7a0000);
  color:white;
  font-weight:900;
  letter-spacing:1px;
  border-radius:16px;
  height:54px;
  padding:0 18px;
  min-width: 220px;
  box-shadow: 0 10px 26px rgba(255,0,0,0.18);
  transition: transform .08s ease, filter .15s ease;
}
button:hover{ filter:brightness(1.08); }
button:active{ transform: scale(0.98); }
button:disabled{ opacity:0.45; cursor:not-allowed; filter: grayscale(1) brightness(0.85); }

.choice{
  background: rgba(28,28,28,0.92);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 20px;
  padding: 18px 16px;
  margin: 12px 0;
  cursor: pointer;
  font-size: 19px;
  line-height: 1.35;
  text-align: left;
  box-shadow: 0 10px 30px rgba(0,0,0,0.45);
  font-weight: 600;
  letter-spacing: 0.2px;
  color: rgba(255,255,255,0.88);
}
.choice.selected{
  border-color: rgba(255,26,26,0.90);
  box-shadow: 0 0 0 2px rgba(255,26,26,0.28), 0 12px 34px rgba(0,0,0,0.5);
}

.word-container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin:16px 0;
  min-height:64px;
  padding:10px;
  border-radius:16px;
  background: rgba(28,28,28,0.75);
  border:1px solid rgba(255,255,255,0.10);
}
.word{
  background: rgba(255,26,26,0.18);
  border:1px solid rgba(255,26,26,0.28);
  padding:10px 14px;
  border-radius:16px;
  font-size:17px;
  font-weight:600; /* not too thick */
  user-select:none;
  cursor:pointer;
}

#hud{
  margin-bottom:14px;
  padding-right: 120px; /* avoid overlap with streak */
}
#hud *{ font-size:14px !important; }

#result{
  margin-top:14px;
  font-size:18px;
  font-weight:950;
  letter-spacing:0.5px;
}
.hint{
  margin-top:12px;
  color:var(--muted);
  font-size:13px;
}

#toast{
  position: fixed;
  left: 50%;
  top: calc(env(safe-area-inset-top) + 20px);
  transform: translateX(-50%);
  z-index: 999999;
  pointer-events: none;
  opacity: 0;
}
.toast-inner{
  display:flex;
  align-items:center;
  gap:10px;
  background: rgba(20,20,20,0.92);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 999px;
  padding: 10px 14px;
  box-shadow: 0 16px 50px rgba(0,0,0,0.55);
  font-weight: 950;
  letter-spacing: 0.6px;
}
.toast-inner.good{
  border-color: rgba(255,26,26,0.45);
  box-shadow: 0 0 0 2px rgba(255,26,26,0.14), 0 16px 50px rgba(0,0,0,0.55);
}
.toast-inner.bad{
  border-color: rgba(255,255,255,0.12);
  opacity: 0.95;
}
.toast-show{ animation: toastInOut 1.0s ease forwards; }
@keyframes toastInOut{
  0%{ opacity:0; transform: translateX(-50%) translateY(-8px) scale(0.96); }
  15%{ opacity:1; transform: translateX(-50%) translateY(0px) scale(1); }
  80%{ opacity:1; transform: translateX(-50%) translateY(0px) scale(1); }
  100%{ opacity:0; transform: translateX(-50%) translateY(-10px) scale(0.98); }
}

.shake{ animation: shake 0.35s ease; }
@keyframes shake{
  0%{ transform: translateX(0); }
  20%{ transform: translateX(-10px); }
  40%{ transform: translateX(10px); }
  60%{ transform: translateX(-7px); }
  80%{ transform: translateX(7px); }
  100%{ transform: translateX(0); }
}

/* Clickable rank in HUD */
#rankBtn{
  background: transparent;
  border: 1px solid rgba(255,255,255,0.16);
  color: rgba(255,255,255,0.88);
  height: 34px;
  min-width: unset;
  padding: 0 10px;
  border-radius: 12px;
  font-weight: 950;
  letter-spacing: 0.6px;
  box-shadow: none;
}
#rankBtn:hover{ filter: brightness(1.1); }

/* Rank modal */
#rankModal{
  position: fixed;
  inset: 0;
  z-index: 999997;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 16px;
  background: rgba(0,0,0,0.72);
  backdrop-filter: blur(8px);
}
#rankModal.show{ display:flex; }
.rank-modal-card{
  width: min(560px, 100%);
  border-radius: 22px;
  padding: 18px 18px 16px;
  background: linear-gradient(180deg, rgba(16,16,16,0.96), rgba(8,8,8,0.96));
  border: 1px solid rgba(255,26,26,0.22);
  box-shadow: 0 28px 90px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,26,26,0.12);
  position: relative;
}
.rank-close{
  position: absolute;
  top: 12px;
  right: 12px;
  width: 44px;
  height: 44px;
  border-radius: 14px;
  min-width: unset;
  padding: 0;
  font-weight: 950;
  letter-spacing: 0;
}
.rank-modal-title{
  margin: 0;
  font-weight: 950;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.92);
  font-size: 16px;
}
.rank-modal-sub{
  margin: 6px 0 14px;
  color: rgba(255,255,255,0.65);
  font-size: 13px;
  line-height: 1.35;
}
.rank-table{
  width: 100%;
  border-collapse: collapse;
  overflow: hidden;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.12);
}
.rank-table th, .rank-table td{
  padding: 12px 12px;
  font-size: 14px;
  color: rgba(255,255,255,0.88);
}
.rank-table th{
  text-align: left;
  color: rgba(255,255,255,0.70);
  font-weight: 900;
  background: rgba(28,28,28,0.85);
  border-bottom: 1px solid rgba(255,255,255,0.10);
}
.rank-table tr{ background: rgba(20,20,20,0.70); }
.rank-table tr + tr td{ border-top: 1px solid rgba(255,255,255,0.08); }
.rank-badge{
  display: inline-block;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,26,26,0.22);
  background: rgba(255,26,26,0.10);
  font-weight: 950;
  letter-spacing: 0.6px;
}
.rank-range{ color: rgba(255,255,255,0.70); font-weight: 800; }
.rank-hintline{
  margin-top: 12px;
  font-size: 12px;
  color: rgba(255,255,255,0.62);
}

/* Mobile fullscreen */
@media (max-width: 520px){
  #container{
    padding: 0 !important;
    height: 100dvh;
    align-items: stretch;
  }
  .card{
    width: 100%;
    min-height: 100dvh;
    border-radius: 0 !important;
    padding:
      calc(env(safe-area-inset-top) + 16px)
      16px
      calc(env(safe-area-inset-bottom) + 18px)
      16px !important;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
  }
  #content{
    flex:1;
    overflow:auto;
    padding-bottom: 86px;
    -webkit-overflow-scrolling: touch;
  }
  .btn-play{
    width: 64%;
    max-width: 320px;
    min-width: unset;
    height: 52px;
    font-size: 15px;
    border-radius: 18px;
    align-self:center;
    margin-left:auto;
    margin-right:auto;
  }
  .btn-check{
    position: sticky;
    bottom: calc(env(safe-area-inset-bottom) + 10px);
    width: 100%;
    min-width: unset;
    height: 58px;
    font-size: 16px;
    border-radius: 18px;
    margin: 14px 0 0;
  }
}
</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="streakBox"></div>
<div id="credit">made by Frihet</div>

<!-- FSD toast -->
<div id="toast">
  <div id="toastInner" class="toast-inner">
    <span>ðŸ’°</span>
    <span class="delta" id="toastText">+2</span>
  </div>
</div>

<!-- Rank modal -->
<div id="rankModal" onclick="onRankBackdrop(event)">
  <div class="rank-modal-card">
    <button class="rank-close" onclick="toggleRankModal(false)">âœ•</button>
    <h3 class="rank-modal-title">RANK LADDER</h3>
    <p class="rank-modal-sub">Your money unit is <b>FSD ðŸ’°</b>. More FSD = higher rank.</p>

    <table class="rank-table">
      <thead><tr><th>Rank</th><th>FSD Range</th></tr></thead>
      <tbody>
        <tr><td><span class="rank-badge">Loser</span></td><td class="rank-range">0â€“49 FSD</td></tr>
        <tr><td><span class="rank-badge">NPC</span></td><td class="rank-range">50â€“149 FSD</td></tr>
        <tr><td><span class="rank-badge">Human</span></td><td class="rank-range">150â€“299 FSD</td></tr>
        <tr><td><span class="rank-badge">Rich</span></td><td class="rank-range">300â€“599 FSD</td></tr>
        <tr><td><span class="rank-badge">Millionaire</span></td><td class="rank-range">600â€“999 FSD</td></tr>
        <tr><td><span class="rank-badge">Billionaire</span></td><td class="rank-range">1000â€“999999 FSD</td></tr>
      </tbody>
    </table>

    <div class="rank-hintline">Tip: Tap <b>Rank</b> again, press âœ•, or tap outside to close.</div>
  </div>
</div>

<div id="container">
  <div class="card" id="intro">
    <h1>KONTRIJAL</h1>
    <h2>YOU VS YOU</h2>
    <div class="terminal-line"></div>
    <button onclick="startGame()">START SESSION â†’</button>
    <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px; letter-spacing: 1px;">made by Frihet</p>
  </div>
</div>

<script>
/* =========================
   Background candles chart
========================= */
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas();
window.addEventListener("resize", () => { resizeCanvas(); initChartCandles(); });

let candles = [];
function rand(min,max){ return Math.random()*(max-min)+min; }

const SPEED = 0.55;
const GAP_MIN = 6, GAP_MAX = 14;
const BODY_W_MIN = 6, BODY_W_MAX = 12;
const UP_BODY_A = 0.22, UP_WICK_A = 0.16;
const DOWN_BODY_A = 0.28, DOWN_WICK_A = 0.18;

function makeCandle(spawnRight=false){
  const w = rand(BODY_W_MIN, BODY_W_MAX);
  const gap = rand(GAP_MIN, GAP_MAX);
  const bodyH = rand(14, 80);
  const wickTop = rand(6, 34);
  const wickBot = rand(6, 30);
  const bandTop = canvas.height * 0.18;
  const bandBot = canvas.height * 0.88;
  const y = rand(bandTop, bandBot - bodyH);
  const isUp = Math.random() < 0.42;

  const upRGB = { r: 40, g: 220, b: 120 };
  const dnRGB = { r: 255, g: 40, b: 40 };

  return {
    x: spawnRight ? canvas.width + rand(0,200) : rand(0,canvas.width),
    y, w, gap, bodyH, wickTop, wickBot, isUp,
    r: isUp ? upRGB.r : dnRGB.r,
    g: isUp ? upRGB.g : dnRGB.g,
    b: isUp ? upRGB.b : dnRGB.b
  };
}
function initChartCandles(){
  candles = [];
  let x = -50;
  while(x < canvas.width + 250){
    const c = makeCandle(false);
    c.x = x;
    candles.push(c);
    x += c.w + c.gap;
  }
}
initChartCandles();

function drawChartCandle(c){
  const centerX = c.x + c.w/2;
  const bodyA = c.isUp ? UP_BODY_A : DOWN_BODY_A;
  const wickA = c.isUp ? UP_WICK_A : DOWN_WICK_A;

  ctx.lineWidth = 1.2;
  ctx.strokeStyle = `rgba(${c.r},${c.g},${c.b},${wickA})`;
  ctx.beginPath();
  ctx.moveTo(centerX, c.y - c.wickTop);
  ctx.lineTo(centerX, c.y + c.bodyH + c.wickBot);
  ctx.stroke();

  ctx.fillStyle = `rgba(${c.r},${c.g},${c.b},${bodyA})`;
  ctx.fillRect(c.x, c.y, c.w, c.bodyH);

  ctx.fillStyle = `rgba(255,255,255,0.035)`;
  ctx.fillRect(c.x + 1, c.y + 2, 1, Math.max(8, c.bodyH - 4));
}
function animateChart(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  candles.forEach(drawChartCandle);
  candles.forEach(c => c.x -= SPEED);

  while(candles.length && candles[0].x + candles[0].w < -60) candles.shift();

  let last = candles[candles.length - 1];
  while(last && last.x < canvas.width + 200){
    const nc = makeCandle(true);
    nc.x = last.x + last.w + last.gap;
    candles.push(nc);
    last = nc;
  }
  requestAnimationFrame(animateChart);
}
animateChart();

/* =========================
   Daily streak
========================= */
function updateStreak(){
  const today = new Date().toDateString();
  const last = localStorage.getItem("lastDate");
  let streak = parseInt(localStorage.getItem("streak") || "0");
  if(last !== today){
    const y = new Date(); y.setDate(y.getDate()-1);
    if(last === y.toDateString()) streak++;
    else streak = 1;
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastDate", today);
  }
  document.getElementById("streakBox").innerText = "ðŸ”¥ Streak: " + (localStorage.getItem("streak") || 1);
}
updateStreak();

/* =========================
   Data: 30 items
   audio is ALWAYS English: audio1..audio30
========================= */
const items = [
  { en:"I feel you, bro. Iâ€™ve also been through a lot.", de:"Ich fÃ¼hl dich, Bro. Ich hab auch schon viel durchgemacht.", es:"Te entiendo, bro. Yo tambiÃ©n he pasado por mucho.", sv:"Jag fattar dig, bro. Jag har ocksÃ¥ gÃ¥tt igenom mycket.", nl:"Ik voel je, bro. Ik heb ook veel meegemaakt." },
  { en:"You donâ€™t need motivation. you just need discipline, bro.", de:"Du brauchst keine Motivation. Du brauchst Disziplin, Bro.", es:"No necesitas motivaciÃ³n. Necesitas disciplina, bro.", sv:"Du behÃ¶ver inte motivation. Du behÃ¶ver bara disciplin, bro.", nl:"Je hebt geen motivatie nodig. Je hebt discipline nodig, bro." },
  { en:"You just need to control yourself. itâ€™s you vs you, bro.", de:"Du musst dich einfach kontrollieren. Es geht nur um dich gegen dich, Bro.", es:"Solo tienes que controlarte. Es tÃº contra tÃº, bro.", sv:"Du mÃ¥ste bara kontrollera dig sjÃ¤lv. Det Ã¤r du mot dig sjÃ¤lv, bro.", nl:"Je moet gewoon jezelf onder controle krijgen. Het is jij tegen jezelf, bro." },
  { en:"I want you to succeed, bro. I believe in you.", de:"Ich will, dass du Erfolg hast, Bro. Ich glaub an dich.", es:"Quiero que tengas Ã©xito, bro. Creo en ti.", sv:"Jag vill att du ska lyckas, bro. Jag tror pÃ¥ dig.", nl:"Ik wil dat je slaagt, bro. Ik geloof in je." },
  { en:"But you know, someone has to do 9 to 5 stuff. Not everyone can be a millionaire.", de:"Aber weiÃŸt du, irgendwer muss halt den 9-to-5-Job machen. Nicht jeder wird MillionÃ¤r.", es:"Pero ya sabes, alguien tiene que trabajar de 9 a 5. No todos van a ser millonarios.", sv:"Men du vet, nÃ¥gon mÃ¥ste jobba 9 till 5. Alla kan inte bli miljonÃ¤rer.", nl:"Maar je weet, iemand moet die 9-tot-5 doen. Niet iedereen kan miljonair worden." },
  { en:"I know itâ€™s hard but dude nothing is easy in this world. You gotta work hard.", de:"Ich weiÃŸ, es ist hart, aber nichts auf dieser Welt ist leicht. Du musst hart arbeiten.", es:"SÃ© que es difÃ­cil, pero nada en este mundo es fÃ¡cil. Tienes que trabajar duro.", sv:"Jag vet att det Ã¤r hÃ¥rt, men inget Ã¤r lÃ¤tt i den hÃ¤r vÃ¤rlden. Du mÃ¥ste jobba hÃ¥rt.", nl:"Ik weet dat het zwaar is, maar niks is makkelijk in deze wereld. Je moet hard werken." },
  { en:"Go ghost, bro. You canâ€™t grow when people are around you.", de:"Zieh dich zurÃ¼ck, Bro. Du kannst nicht wachsen, wenn stÃ¤ndig Leute um dich herum sind.", es:"Desaparece un rato, bro. No puedes crecer si la gente siempre estÃ¡ alrededor.", sv:"FÃ¶rsvinn ett tag, bro. Du kan inte vÃ¤xa nÃ¤r folk alltid Ã¤r runt dig.", nl:"Ga even offline, bro. Je kunt niet groeien als mensen altijd om je heen zijn." },
  { en:"Lock in. You wanna be rich or not?", de:"Fokussier dich. Willst du reich werden oder nicht?", es:"ConcÃ©ntrate. Â¿Quieres ser rico o no?", sv:" Fokusera. Vill du bli rik eller inte?", nl:"Focus. Wil je rijk worden of niet?"},
  { en:"I donâ€™t wanna be an NPC, bro. Thatâ€™s why Iâ€™m working this hard.", de:"Ich will kein NPC sein, Bro. Deshalb arbeite ich so hart.", es:"No quiero ser un NPC, bro. Por eso estoy trabajando asÃ­ de duro.", sv:"Jag vill inte vara en NPC, bro. Det Ã¤r dÃ¤rfÃ¶r jag jobbar sÃ¥ hÃ¤r hÃ¥rt.", nl:"Ik wil geen NPC zijn, bro. Daarom werk ik zo hard." },
  { en:"You think I enjoy going to the gym every day? Hell nah, bro. I genuinely donâ€™t.", de:"Denkst du, ich geh gern jeden Tag ins Gym? Hell nah, Bro. Ehrlich nicht.", es:"Â¿Crees que disfruto ir al gym todos los dÃ­as? Hell nah, bro. De verdad que no.", sv:"Tror du att jag gillar att gÃ¥ till gymmet varje dag? Hell nah, bro. Verkligen inte.", nl:"Denk je dat ik elke dag naar de gym ga omdat ik het leuk vind? Hell nah, bro. Echt niet." },
  { en:"You live only one life, bro. Nothing can stop you. do what you want.", de:"Du hast nur ein Leben, Bro. Nichts kann dich aufhalten. Mach, was du willst.", es:"Solo tienes una vida, bro. Nada puede detenerte. Haz lo que quieras.", sv:"Du lever bara ett liv, bro. Inget kan stoppa dig. GÃ¶r vad du vill.", nl:"Je leeft maar Ã©Ã©n keer, bro. Niks kan je stoppen. Doe wat je wilt." },
  { en:"If you want big money, make a big move. You canâ€™t get rich with a 9 to 5 job, you know that.", de:"Wenn du groÃŸes Geld willst, musst du groÃŸe Moves machen. Mit einem 9-to-5-Job wirst du nicht reich, das weiÃŸt du.", es:"Si quieres mucho dinero, haz un gran movimiento. No te vas a hacer rico con un trabajo de 9 a 5, tÃº lo sabes.", sv:"Vill du ha stora pengar, gÃ¶r stora moves. Du blir inte rik pÃ¥ ett 9 till 5 jobb, du vet det.", nl:"Wil je groot geld? Maak grote moves. Je wordt niet rijk met een 9-tot-5 baan, dat weet je." },
  { en:"If you wanna be different, you gotta be emotionless, bro. Learn to control your emotions", de:"Wenn du anders sein willst, musst du emotionslos sein, Bro. Lern, deine Emotionen zu kontrollieren.", es:"Si quieres ser diferente, tienes que ser frÃ­o, bro. Aprende a controlar tus emociones.", sv:"Vill du vara annorlunda mÃ¥ste du vara kÃ¤nslokall, bro. LÃ¤r dig kontrollera dina kÃ¤nslor.", nl:"Wil je anders zijn, dan moet je emotieloos zijn, bro. Leer je emoties te controleren." },
  { en:"Bro, everyoneâ€™s lost. Itâ€™s not just you. Weâ€™re all lost. Thatâ€™s the beauty of life", de:"Bro, jeder ist verloren. Nicht nur du. Wir sind alle verloren. Das ist das SchÃ¶ne am Leben.", es:"Bro, todos estamos perdidos. No eres solo tÃº. Todos estamos perdidos. Esa es la belleza de la vida.", sv:"Bro, alla Ã¤r vilsna. Det Ã¤r inte bara du. Vi Ã¤r alla vilsna. Det Ã¤r det fina med livet.", nl:"Bro, iedereen is verloren. Niet alleen jij. We zijn allemaal verloren. Dat is het mooie van het leven." },

  { en:"Go hit the gym, bro. It's your body. Take care of it.", de:"Geh ins Gym, Bro. Das ist dein KÃ¶rper. KÃ¼mmere dich darum.", es:"Ve al gym, bro. Es tu cuerpo. CuÃ­dalo.", sv:"GÃ¥ till gymmet, bro. Det Ã¤r din kropp. Ta hand om den.", nl:"Ga naar de gym, bro. Het is jouw lichaam. Zorg ervoor." },
  { en:"Stop scrolling all that stupid stuff, bro. Ainâ€™t you scared itâ€™s messing up your brain? I donâ€™t get how people donâ€™t even care.", de:"HÃ¶r auf, diesen ganzen dummen Mist zu scrollen, Bro. Hast du keine Angst, dass das dein Gehirn kaputtmacht? Ich check nicht, wie Leute das einfach egal finden.", es:"Deja de scrollear toda esa basura, bro. Â¿No te da miedo que te estÃ© jodiendo el cerebro? No entiendo cÃ³mo a la gente ni siquiera le importa.", sv:"Sluta scrolla allt det dÃ¤r skitet, bro. Ã„r du inte rÃ¤dd att det fÃ¶rstÃ¶r din hjÃ¤rna? Jag fattar inte hur folk inte ens bryr sig.", nl:"Stop met al die domme shit scrollen, bro. Ben je niet bang dat het je brein verpest? Ik snap niet hoe mensen het niet eens boeit." },
  { en:"Manifesting works, dude. Not magic. itâ€™s because you act on what youâ€™re thinking unconsciously.", de:"Manifestieren funktioniert, Bro. Nicht wegen Magie. Sondern weil du unbewusst nach dem handelst, woran du denkst.", es:"Manifestar funciona, bro. No es magia. Es porque actÃºas inconscientemente segÃºn lo que estÃ¡s pensando.", sv:"Manifestering funkar, dude. Inte magi. Det Ã¤r fÃ¶r att du agerar pÃ¥ det du tÃ¤nker utan att mÃ¤rka det.", nl:"Manifesteren werkt, dude. Geen magie. Het is omdat je onbewust handelt naar wat je denkt." },
  { en:"You donâ€™t even know how valuable you are. Thatâ€™s why you end up like that.", de:"Du weiÃŸt nicht mal, wie wertvoll du bist. Deshalb landest du am Ende genau so.", es:"Ni siquiera sabes lo valioso que eres. Por eso terminas asÃ­.", sv:"Du fattar inte ens hur vÃ¤rdefull du Ã¤r. Det Ã¤r dÃ¤rfÃ¶r du hamnar dÃ¤r du hamnar.", nl:"Je weet niet eens hoe waardevol je bent. Daarom eindig je zo." },
  { en:"I learned it the hard way, bro. You canâ€™t trust anyone in life. For real, you can only trust yourself.", de:"Ich habâ€™s auf die harte Tour gelernt, Bro. Du kannst im Leben niemandem vertrauen. Ehrlich: Am Ende kannst du nur dir selbst vertrauen.", es:"Lo aprendÃ­ por las malas, bro. No puedes confiar en nadie en la vida. De verdad: al final solo puedes confiar en ti mismo.", sv:"Jag lÃ¤rde mig det den hÃ¥rda vÃ¤gen, bro. Du kan inte lita pÃ¥ nÃ¥gon i livet. PÃ¥ riktigt, du kan bara lita pÃ¥ dig sjÃ¤lv.", nl:"Ik heb het op de harde manier geleerd, bro. Je kunt niemand vertrouwen in het leven. Echt, je kunt alleen jezelf vertrouwen." },
  { en:"Itâ€™s your life, bro. Take control and own it.", de:"Es ist dein Leben, Bro. Ãœbernimm die Kontrolle und steh dazu.", es:"Es tu vida, bro. Toma el control y hazte cargo.", sv:"Det Ã¤r ditt liv, bro. Ta kontroll och Ã¤g det.", nl:"Het is jouw leven, bro. Neem controle en own het." },
  { en:"Work first, man. Money always comes last, no matter what.", de:"Arbeite zuerst, Bro. Geld kommt immer zuletzt, egal was passiert.", es:"Trabaja primero, bro. El dinero siempre viene despuÃ©s, pase lo que pase.", sv:"Jobba fÃ¶rst, mannen. Pengar kommer alltid sist, oavsett vad.", nl:"Werk eerst, man. Geld komt altijd als laatste, wat er ook gebeurt." },
  { en:"You know humans just love comfort, bro. Yeah, thatâ€™s why itâ€™s so hard to do the hard stuff.", de:"Menschen lieben einfach Komfort, Bro. Genau deshalb ist es so schwer, die harten Sachen zu machen.", es:"Los humanos aman la comodidad, bro. Por eso es tan difÃ­cil hacer las cosas duras.", sv:"Du vet att mÃ¤nniskor Ã¤lskar bekvÃ¤mlighet, bro. Det Ã¤r dÃ¤rfÃ¶r det Ã¤r sÃ¥ svÃ¥rt att gÃ¶ra det hÃ¥rda skitet.", nl:"Mensen houden van comfort, bro. Daarom is het zo moeilijk om het harde werk te doen." },
  { en:"You want me to be honest? Bro, you canâ€™t be successful doing what everyone else does. Wanna be successful? Do what nobody else is doing, man.", de:"Willst du, dass ich ehrlich bin? Bro, du kannst nicht erfolgreich sein, wenn du machst, was alle anderen machen. Willst du Erfolg? Dann mach, was sonst keiner macht.", es:"Â¿Quieres que sea honesto? Bro, no puedes tener Ã©xito haciendo lo mismo que todos. Â¿Quieres tener Ã©xito? Haz lo que nadie mÃ¡s hace.", sv:"Vill du att jag ska vara Ã¤rlig? Bro, du kan inte bli framgÃ¥ngsrik genom att gÃ¶ra som alla andra. Vill du lyckas? GÃ¶r det ingen annan gÃ¶r.", nl:"Wil je dat ik eerlijk ben? Bro, je wordt niet succesvol door te doen wat iedereen doet. Wil je succes? Doe wat niemand anders doet." },
  { en:"If people are constantly talking about you, lucky you, dude youâ€™ve got a fan group.", de:"Wenn die Leute stÃ¤ndig Ã¼ber dich reden: GlÃ¼ck fÃ¼r dich, Bro du hast schon deine eigene Fangruppe.", es:"Si la gente habla de ti todo el tiempo, suerte la tuya, bro ya tienes tu propio grupo de fans.", sv:"Om folk snackar om dig hela tiden â€” grattis, dude, du har redan en fangrupp.", nl:"Als mensen constant over je praten, geluk jij, dude je hebt al een fangroep." },
  { en:"The thing is, dude, nobody cares about you that deeply. Do you even remember what happened 4 hours ago? If you do, youâ€™re in trouble, bro. Canâ€™t even lie.", de:"Die Sache ist, Bro: Niemand interessiert sich so tief fÃ¼r dich. Erinnerst du dich Ã¼berhaupt, was vor 4 Stunden passiert ist? Wenn ja, hast du ein Problem. Kein Witz.", es:"La cosa es, bro: a nadie le importas tan profundamente. Â¿De verdad recuerdas lo que pasÃ³ hace 4 horas? Si sÃ­, estÃ¡s en problemas. No te voy a mentir.", sv:"Grejen Ã¤r, dude, ingen bryr sig sÃ¥ djupt om dig. Kommer du ens ihÃ¥g vad som hÃ¤nde fÃ¶r 4 timmar sen? Om du gÃ¶r det Ã¤r du i trubbel, bro. Ã„r bara Ã¤rlig.", nl:"Het ding is, dude, niemand geeft zo diep om je. Weet je nog wat er 4 uur geleden gebeurde? Als wel, dan heb je een probleem, bro. Eerlijk." },
  { en:"Stop distracting yourself, dude. Youâ€™ll come back to reality eventually.", de:"HÃ¶r auf, dich abzulenken, Bro. FrÃ¼her oder spÃ¤ter holt dich die RealitÃ¤t ein.", es:"Deja de distraerte, bro. Tarde o temprano vas a volver a la realidad.", sv:"Sluta distrahera dig sjÃ¤lv, dude. Du kommer tillbaka till verkligheten fÃ¶rr eller senare.", nl:"Stop met jezelf afleiden, dude. Uiteindelijk kom je toch terug in de realiteit." },
  { en:"Everything changes, bro. Thatâ€™s life.", de:"Alles verÃ¤ndert sich, Bro. So ist das Leben.", es:"Todo cambia, bro. AsÃ­ es la vida.", sv:"Allt fÃ¶rÃ¤ndras, bro. SÃ¥ Ã¤r livet.", nl:"Alles verandert, bro. Dat is het leven." },
  { en:"Itâ€™s never too late in life, dude. Wake up.", de:"Es ist im Leben nie zu spÃ¤t, Bro. Wach auf.", es:"Nunca es demasiado tarde en la vida, bro. Despierta.", sv:"Det Ã¤r aldrig fÃ¶r sent i livet, dude. Vakna.", nl:"Het is nooit te laat in het leven, dude. Word wakker." },
  { en:"Itâ€™s really hard to balance work and rest, but 100% work is always better than 100% rest.", de:"Es ist verdammt schwer, Arbeit und Pause auszubalancieren, aber 100% Arbeit ist immer besser als 100% Pause.", es:"Es muy difÃ­cil equilibrar trabajo y descanso, pero 100% trabajo siempre es mejor que 100% descanso.", sv:"Det Ã¤r svÃ¥rt att balansera jobb och vila, men 100% jobb Ã¤r alltid bÃ¤ttre Ã¤n 100% vila.", nl:"Het is moeilijk om werk en rust te balanceren, maar 100% werk is altijd beter dan 100% rust." },
  { en:"You know, hate is a really big emotion, mate. Donâ€™t waste it.", de:"WeiÃŸt du, Hass ist eine verdammt groÃŸe Emotion, Bro. Verschwend sie nicht.", es:"Sabes, el odio es una emociÃ³n enorme, bro. No la desperdicies.", sv:"Du vet, hat Ã¤r en stark kÃ¤nsla, mate. SlÃ¶sa inte bort den.", nl:"Haat is een sterke emotie, mate. Verspil het niet."  }
];

/* 6 levels, 5 sentences each */
const LEVELS = [
  { id:"L1", name:"LEVEL 1", idx:[0,1,2,3,4] },
  { id:"L2", name:"LEVEL 2", idx:[5,6,7,8,9] },
  { id:"L3", name:"LEVEL 3", idx:[10,11,12,13,14] },
  { id:"L4", name:"LEVEL 4", idx:[15,16,17,18,19] },
  { id:"L5", name:"LEVEL 5", idx:[20,21,22,23,24] },
  { id:"L6", name:"LEVEL 6", idx:[25,26,27,28,29] }
];

/* =========================
   Language UI
========================= */
let nativeLang = localStorage.getItem("nativeLang") || "en";
const UI = {
  en: { chooseNative:"Choose your native language", levels:"KONTRIJAL PATH", levelHint:"Perfect score unlocks next level.",
        play:"PLAY", check:"CHECK", listenDecide:"Listen & Decide", buildFocus:"Build With Focus",
        locked:"LOCKED.", wrong:"-1. Refocus.", fsd:"FSD", rank:"Rank", progress:"Progress",
        levelComplete:"LEVEL COMPLETE", perfect:"âœ… PERFECT. NEXT LEVEL UNLOCKED.", notPerfect:"âŒ NOT PERFECT. RUN IT BACK.",
        retry:"RETRY LEVEL â†’", home:"GO HOME â†’", backHome:"BACK TO HOME" },
  de: { chooseNative:"WÃ¤hle deine Muttersprache", levels:"KONTRIJAL PATH", levelHint:"Perfekt = nÃ¤chstes Level frei.",
        play:"PLAY", check:"PRÃœFEN", listenDecide:"HÃ¶ren & Entscheiden", buildFocus:"Satz bauen",
        locked:"LOCKED.", wrong:"-1. Fokus.", fsd:"FSD", rank:"Rang", progress:"Fortschritt",
        levelComplete:"LEVEL GESCHAFFT", perfect:"âœ… PERFEKT. NÃ„CHSTES LEVEL FREI.", notPerfect:"âŒ NICHT PERFEKT. NOCHMAL.",
        retry:"LEVEL WIEDERHOLEN â†’", home:"ZURÃœCK â†’", backHome:"ZURÃœCK" },
  es: { chooseNative:"Elige tu idioma nativo", levels:"KONTRIJAL PATH", levelHint:"Puntaje perfecto desbloquea el siguiente.",
        play:"PLAY", check:"COMPROBAR", listenDecide:"Escucha y decide", buildFocus:"Construye la frase",
        locked:"LOCKED.", wrong:"-1. EnfÃ³cate.", fsd:"FSD", rank:"Rango", progress:"Progreso",
        levelComplete:"NIVEL COMPLETADO", perfect:"âœ… PERFECTO. SIGUIENTE NIVEL DESBLOQUEADO.", notPerfect:"âŒ NO PERFECTO. REPITE.",
        retry:"REINTENTAR â†’", home:"INICIO â†’", backHome:"VOLVER" },
 sv: {
  chooseNative:"VÃ¤lj ditt modersmÃ¥l",
  levels:"KONTRIJAL PATH",
  levelHint:"Perfekt poÃ¤ng lÃ¥ser upp nÃ¤sta nivÃ¥.",
  play:"SPELA",
  check:"KOLLA",
  listenDecide:"Lyssna & vÃ¤lj",
  buildFocus:"Bygg meningen",
  locked:"LOCKED.",
  wrong:"-1. Fokusera.",
  fsd:"FSD",
  rank:"Rank",
  progress:"Progress",
  levelComplete:"NIVÃ… KLAR",
  perfect:"âœ… PERFEKT. NÃ„STA NIVÃ… UPPLÃ…ST.",
  notPerfect:"âŒ INTE PERFEKT. KÃ–R IGEN.",
  retry:"KÃ–R IGEN â†’",
  home:"HEM â†’",
  backHome:"TILLBAKA HEM"
},

nl: {
  chooseNative:"Kies je moedertaal",
  levels:"KONTRIJAL PATH",
  levelHint:"Perfecte score ontgrendelt het volgende level.",
  play:"PLAY",
  check:"CHECK",
  listenDecide:"Luister & kies",
  buildFocus:"Bouw de zin",
  locked:"LOCKED.",
  wrong:"-1. Focus.",
  fsd:"FSD",
  rank:"Rang",
  progress:"Voortgang",
  levelComplete:"LEVEL VOLTOOID",
  perfect:"âœ… PERFECT. VOLGEND LEVEL ONTGRENDELD.",
  notPerfect:"âŒ NIET PERFECT. OPNIEUW.",
  retry:"OPNIEUW â†’",
  home:"NAAR HOME â†’",
  backHome:"TERUG NAAR HOME"
}
};
function t(key){ return (UI[nativeLang] && UI[nativeLang][key]) || UI.en[key] || key; }

/* =========================
   Persistent FSD + ranks
========================= */
const FSD_KEY = "fsd_forever";
function getFSD(){ return parseInt(localStorage.getItem(FSD_KEY) || "0"); }
function setFSD(v){ if(v<0) v=0; localStorage.setItem(FSD_KEY, String(v)); }
function addFSD(delta){ const now = getFSD() + delta; setFSD(now); return getFSD(); }

const RANKS = [
  { name:"Loser",       min:0,    max:49 },
  { name:"NPC",         min:50,   max:149 },
  { name:"Human",       min:150,  max:299 },
  { name:"Rich",        min:300,  max:599 },
  { name:"Millionaire", min:600,  max:999 },
  { name:"Billionaire", min:1000, max:999999 }
];
function rankFor(v){ return RANKS.find(r => v>=r.min && v<=r.max) || RANKS[0]; }
function nextRankInfo(v){
  const r = rankFor(v);
  const idx = RANKS.indexOf(r);
  if(idx === RANKS.length-1) return { pct:100, label:"MAX" };
  const next = RANKS[idx+1];
  const need = next.min - r.min;
  const have = v - r.min;
  return { pct: Math.max(0, Math.min(100, Math.round((have/need)*100))), label:`${v}/${next.min}` };
}

/* =========================
   Unlocks per language
========================= */
function unlockKey(){ return "unlockedLevel_" + (nativeLang || "en"); }
function getUnlockedLevel(){ return parseInt(localStorage.getItem(unlockKey()) || "1"); }
function setUnlockedLevel(n){ localStorage.setItem(unlockKey(), String(n)); }
function levelNum(id){ return parseInt(id.replace("L",""),10); }
function isUnlocked(levelId){ return levelNum(levelId) <= getUnlockedLevel(); }

/* Bonus: 2 perfect levels in a row => +5 FSD */
function noFailKey(){ return "noFailStreak_" + (nativeLang || "en"); }
function getNoFailStreak(){ return parseInt(localStorage.getItem(noFailKey()) || "0"); }
function setNoFailStreak(n){ localStorage.setItem(noFailKey(), String(n)); }

/* =========================
   Game state
========================= */
let activeLevel = "L1";
let activeItems = []; // each entry: {en,de,es, globalIndex}
let used = [];
let round = 0;
let score = 0;
let mistakes = 0;
let audio = null;

/* =========================
   Screens
========================= */
function startGame(){
  document.getElementById("container").innerHTML = `
    <div class="card">
      <h2 style="margin-top:0;">${t("chooseNative")}</h2>
      <div style="margin-top:18px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center;">
        <button onclick="chooseLang('en')">ðŸ‡¬ðŸ‡§ English</button>
        <button onclick="chooseLang('de')">ðŸ‡©ðŸ‡ª Deutsch</button>
        <button onclick="chooseLang('es')">ðŸ‡ªðŸ‡¸ EspaÃ±ol</button>
        <button onclick="chooseLang('sv')">ðŸ‡¸ðŸ‡ª Svenska</button>
        <button onclick="chooseLang('nl')">ðŸ‡³ðŸ‡± Nederlands</button>
      </div>
      <p style="color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 20px;">made by Frihet</p>
    </div>
  `;
}
function chooseLang(lang){
  nativeLang = lang;
  localStorage.setItem("nativeLang", lang);
  renderHome();
}

function renderHome(){
  const unlocked = getUnlockedLevel();
  let html = `
    <div class="card" id="home">
      <h2 style="margin-top:0; letter-spacing:1px;">${t("levels")}</h2>
      <p style="color:#aaa; margin-top:8px;">${t("levelHint")}</p>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:16px;" id="levelGrid"></div>

      <div style="margin-top:16px; color:rgba(255,255,255,0.75); font-size:13px;">
        ðŸ’° ${t("fsd")}: <b>${getFSD()}</b> Â· ${t("rank")}: <b>${rankFor(getFSD()).name}</b>
      </div>
    </div>
  `;
  document.getElementById("container").innerHTML = html;

  const grid = document.getElementById("levelGrid");
  LEVELS.forEach(lv => {
    const n = levelNum(lv.id);
    const locked = n > unlocked;
    const btn = document.createElement("button");
    btn.style.minWidth = "unset";
    btn.style.width = "100%";
    btn.style.height = "66px";
    btn.style.borderRadius = "18px";
    btn.style.fontSize = "16px";
    btn.style.fontWeight = "950";
    btn.innerHTML = locked ? `ðŸ”’ ${lv.name}` : `ðŸ’° ${lv.name}`;
    btn.disabled = locked;
    btn.onclick = () => startLevel(lv.id);
    grid.appendChild(btn);
  });
}

function startLevel(levelId){
  activeLevel = levelId;

  const lv = LEVELS.find(x => x.id === levelId);
  activeItems = lv.idx.map(i => ({...items[i], globalIndex: i})); // store global index for audio

  used = [];
  round = 0;
  score = 0;
  mistakes = 0;
  stopAudio();

  document.getElementById("container").innerHTML = `
    <div class="card" id="gameCard">
      <div id="hud" style="text-align:left; margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">
          <div style="font-size:13px; color:#aaa;">
            <b>${lv.name}</b> Â· ${t("progress")}: <span id="progressText">0/${activeItems.length}</span>
          </div>
          <div style="font-size:13px; color:#aaa; text-align:right;">
            ðŸ’° ${t("fsd")}: <span id="fsdText">${getFSD()}</span><br>
            ${t("rank")}:
            <button id="rankBtn" onclick="toggleRankModal()">
              <span id="rankText">${rankFor(getFSD()).name}</span> â“˜
            </button>
          </div>
        </div>

        <div style="margin-top:10px; background:#1a1a1a; border-radius:999px; height:10px; overflow:hidden;">
          <div id="progressBar" style="height:10px; width:0%; background:#ff1a1a;"></div>
        </div>

        <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
          <div style="font-size:13px; color:#aaa;">
            Next: <span id="nextRankText">0/50</span>
          </div>
        </div>

        <div style="margin-top:8px; background:#1a1a1a; border-radius:999px; height:10px; overflow:hidden;">
          <div id="rankBar" style="height:10px; width:0%; background:#ff1a1a;"></div>
        </div>
      </div>

      <h2 id="mode" style="margin:8px 0 12px; font-size:22px; letter-spacing:0.5px;"></h2>

      <button class="btn-play" onclick="playAudio()">${t("play")}</button>

      <div id="content"></div>
      <div id="result"></div>

      <div style="margin-top:14px;">
      
      </div>
    </div>
  `;

  updateHUD();
  nextRound();
}

/* =========================
   HUD + helpers
========================= */
function updateHUD(){
  const done = used.length;
  const pText = document.getElementById("progressText");
  const pBar = document.getElementById("progressBar");
  if(pText) pText.innerText = done + "/" + activeItems.length;
  if(pBar) pBar.style.width = Math.round((done/activeItems.length)*100) + "%";

  const fsd = getFSD();
  const r = rankFor(fsd);
  const nxt = nextRankInfo(fsd);

  const fsdText = document.getElementById("fsdText");
  const rankText = document.getElementById("rankText");
  const nextRankText = document.getElementById("nextRankText");
  const rankBar = document.getElementById("rankBar");

  if(fsdText) fsdText.innerText = fsd;
  if(rankText) rankText.innerText = r.name;
  if(nextRankText) nextRankText.innerText = nxt.label;
  if(rankBar) rankBar.style.width = (nxt.pct || 0) + "%";
}

function normalize(s){
  return s.toLowerCase().replace(/[.,!?]/g,"").replace(/\s+/g,"").trim();
}
function displayText(obj){
  return obj[nativeLang] || obj.en;
}

/* =========================
   Game loop (MIX)
========================= */
function nextRound(){
  if(round >= activeItems.length){
    finishLevel();
    return;
  }

  round++;
  document.getElementById("result").innerText = "";
  const content = document.getElementById("content");
  content.innerHTML = "";

  // unique random
  let idx;
  do{ idx = Math.floor(Math.random()*activeItems.length); }
  while(used.includes(idx));
  used.push(idx);

  updateHUD();

  // MIX: 50/50
  if(Math.random() > 0.5) buildListen(idx);
  else buildDrag(idx);
}

function buildListen(idx){
  document.getElementById("mode").innerText = t("listenDecide");

  const correctObj = activeItems[idx];
  const correctText = displayText(correctObj);

  // 4 options
  let optionIndexes = [idx];
  while(optionIndexes.length < 4){
    const r = Math.floor(Math.random()*activeItems.length);
    if(!optionIndexes.includes(r)) optionIndexes.push(r);
  }
  optionIndexes.sort(()=>0.5 - Math.random());

  let selected = null;

  optionIndexes.forEach(i=>{
    const div = document.createElement("div");
    div.className = "choice";
    div.innerText = displayText(activeItems[i]);
    div.onclick = ()=>{
      document.querySelectorAll(".choice").forEach(c=>c.classList.remove("selected"));
      div.classList.add("selected");
      selected = div.innerText;
    };
    document.getElementById("content").appendChild(div);
  });

  const btn = document.createElement("button");
  btn.className = "btn-check";
  btn.innerText = t("check");
  btn.onclick = ()=>{
    if(!selected) return;
    if(normalize(selected) === normalize(correctText)) success();
    else fail();
  };
  document.getElementById("content").appendChild(btn);

  if(nativeLang !== "en"){
    const hint = document.createElement("div");
    hint.className = "hint";
    hint.innerText = "English: " + correctObj.en;
    document.getElementById("content").appendChild(hint);
  }
}

function buildDrag(idx){
  document.getElementById("mode").innerText = t("buildFocus");

  const targetObj = activeItems[idx];
  const targetSentence = displayText(targetObj);

  const words = targetSentence.split(" ");
  const shuffled = [...words].sort(()=>0.5 - Math.random());

  const top = document.createElement("div");
  top.className = "word-container";
  top.id = "top";

  const bottom = document.createElement("div");
  bottom.className = "word-container";
  bottom.id = "bottom";

  shuffled.forEach(w=>{
    const chip = document.createElement("div");
    chip.className = "word";
    chip.innerText = w;
    chip.onclick = ()=>{
      if(chip.parentElement.id === "bottom") top.appendChild(chip);
      else bottom.appendChild(chip);
    };
    bottom.appendChild(chip);
  });

  const btn = document.createElement("button");
  btn.className = "btn-check";
  btn.innerText = t("check");
  btn.onclick = ()=>{
    let built = "";
    document.querySelectorAll("#top .word").forEach(w=> built += w.innerText + " ");
    if(normalize(built) === normalize(targetSentence)) success();
    else fail();
  };

  const c = document.getElementById("content");
  c.appendChild(top);
  c.appendChild(bottom);
  c.appendChild(btn);

  if(nativeLang !== "en"){
    const hint = document.createElement("div");
    hint.className = "hint";
    hint.innerText = "English: " + targetObj.en;
    c.appendChild(hint);
  }
}

/* =========================
   Level finish + rules
========================= */
function finishLevel(){
  const perfect = (score === activeItems.length) && (mistakes === 0);

  // unlock next level ONLY if perfect
  const currentNum = levelNum(activeLevel);
  if(perfect){
    const unlocked = getUnlockedLevel();
    if(currentNum >= unlocked && unlocked < 6) setUnlockedLevel(unlocked + 1);
  }

  // bonus: 2 perfect levels in a row => +5 FSD
  if(perfect){
    let s = getNoFailStreak() + 1;
    if(s >= 2){
      addFSD(+5);
      s = 0;
      showToast(+5);
    }
    setNoFailStreak(s);
  } else {
    setNoFailStreak(0);
  }

  updateHUD();

  document.getElementById("content").innerHTML = `
    <h2 style="margin-top:6px;">${t("levelComplete")}</h2>
    <p>${t("progress")}: <b>${score} / ${activeItems.length}</b></p>
    <p style="margin-top:10px; font-weight:950;">
      ${perfect ? t("perfect") : t("notPerfect")}
    </p>

    <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:14px;">
      <button onclick="${perfect ? "renderHome()" : "startLevel(activeLevel)"}">
        ${perfect ? t("home") : t("retry")}
      </button>
      <button onclick="renderHome()" style="min-width:unset;">LEVEL SELECT</button>
    </div>
  `;
}

/* =========================
   Feedback + FSD rules
========================= */
function showToast(delta){
  const toast = document.getElementById("toast");
  const inner = document.getElementById("toastInner");
  const text = document.getElementById("toastText");
  toast.classList.remove("toast-show");
  inner.classList.remove("good","bad");

  if(delta > 0){
    inner.classList.add("good");
    text.textContent = `+${delta} FSD ðŸ’°`;
  } else {
    inner.classList.add("bad");
    text.textContent = `${delta} FSD ðŸ’°`;
  }
  void toast.offsetWidth;
  toast.classList.add("toast-show");
}

function shakeCard(){
  const card = document.getElementById("gameCard");
  if(!card) return;
  card.classList.remove("shake");
  void card.offsetWidth;
  card.classList.add("shake");
}

function success(){
  playSound(true);
  score++;
  addFSD(+2);
  showToast(+2);
  updateHUD();
  document.getElementById("result").innerText = t("locked");
  stopAudio();
  setTimeout(nextRound, 950);
}

function fail(){
  playSound(false);
  mistakes++;
  addFSD(-1);
  showToast(-1);
  shakeCard();
  updateHUD();
  document.getElementById("result").innerText = t("wrong");
  stopAudio();

  const currentNum = levelNum(activeLevel);

  // HARDCORE RULE: Level 2+ => 1 mistake = drop to previous level
  if(currentNum > 1 && mistakes >= 1){
    const prev = "L" + (currentNum - 1);
    setTimeout(() => {
      document.getElementById("content").innerHTML = `
        <h2 style="color:#ff1a1a; margin-top:6px;">FAILED.</h2>
        <p>You made a mistake.</p>
        <p style="opacity:0.85;">â¬‡ Back to <b>${prev}</b></p>
        <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:14px;">
          <button onclick="startLevel('${prev}')">GO BACK â†’</button>
          <button onclick="renderHome()" style="min-width:unset;">LEVEL SELECT</button>
        </div>
      `;
    }, 650);
    return;
  }

  // Level 1: keep going
  setTimeout(nextRound, 1050);
}

/* =========================
   Audio
========================= */
function playAudio() {
  try {
    stopAudio();

    // Make sure level exists
    const lv = LEVELS.find(l => l.id === activeLevel);
    if (!lv) {
      alert("ERROR: activeLevel not found in LEVELS: " + activeLevel);
      return;
    }

    // Make sure currentIndex points to something in this level
    if (typeof currentIndex !== "number") {
      alert("ERROR: currentIndex is not a number: " + currentIndex);
      return;
    }

    const baseIndex = lv.idx[currentIndex];
    if (typeof baseIndex !== "number") {
      alert("ERROR: lv.idx mismatch.\nactiveLevel=" + activeLevel +
            "\ncurrentIndex=" + currentIndex +
            "\nlv.idx[currentIndex]=" + baseIndex);
      return;
    }

    // Your new filename format
    const file = `en_audio${baseIndex + 1}.mp3`;

    audio = new Audio(file);

    audio.addEventListener("error", () => {
      alert("AUDIO NOT FOUND (or path wrong): " + file);
    });

    audio.play().catch(err => {
      alert("PLAY FAILED (browser blocked it): " + err);
    });

  } catch (e) {
    alert("JS CRASH inside playAudio(): " + e.message);
  }
}
function stopAudio(){
  if(audio){ audio.pause(); audio.currentTime = 0; }
}

/* Soft click sound */
function playSound(success){
  const aCtx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = aCtx.createOscillator();
  const gain = aCtx.createGain();
  osc.connect(gain);
  gain.connect(aCtx.destination);
  osc.frequency.value = success ? 600 : 220;
  gain.gain.value = 0.05;
  osc.start();
  setTimeout(()=>osc.stop(), 90);
}

/* =========================
   Rank modal logic
========================= */
function toggleRankModal(force){
  const modal = document.getElementById("rankModal");
  const open = (typeof force === "boolean") ? force : !modal.classList.contains("show");
  if(open) modal.classList.add("show");
  else modal.classList.remove("show");
}
function onRankBackdrop(e){
  if(e.target && e.target.id === "rankModal") toggleRankModal(false);
}
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") toggleRankModal(false); });

</script>
</body>
</html>



























